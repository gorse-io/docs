---
icon: zhinengsuanfa
date: 2025-07-05
category:
  - 技术分享
tag:
  - 机器学习
---
# 推荐场景下文本嵌入模型性能对比

向量嵌入技术可以将图片、文字等信息转换为高维向量，从而能够在搜素推荐等场景下，通过计算向量之间的距离来计算图片、文本等原始内容之间的相关性。其中本文嵌入用到最多，市面上主要的AI服务商都会为他们的用户提供本文嵌入API，另外也有很多开源文本嵌入模型可供自行部署使用。目前主流的文本嵌入模型的评估标准为[MTEB](https://github.com/embeddings-benchmark/mteb)，但是[MTEB](https://github.com/embeddings-benchmark/mteb)并没有评估文本嵌入模型在推荐系统中的能力，而本文将尝试评估文本嵌入模型在推荐场景下的表现。

## 实验指标

嵌入向量在推荐系统中通常用于相似推荐或者相关推荐，希望嵌入向量之间的距离能够很好地表达推荐物料之前的相似性和相关性。物料之间的相关性和相似度实际上不存在标准答案，在推荐系统中可以使用物料之间用户的重叠程度$s_{ij}$来近似地衡量物料之间的相似度或者相关性。

$$
s_{ij} = \frac{|U_i \cap U_j|}{|U_i \cup U_j|}
$$

其中$U_i$和$U_j$分别表示物料$i$和$j$的用户集合，$s_{ij}$的值越大，表示物料$i$和$j$之间的用户重叠度越高。而向量之间的距离可以使用欧式距离计算：

$$
d_{ij} = ||v_i - v_j||
$$

其中$v_i$和$v_j$分别表示物料$i$和$j$的嵌入向量。为了衡量嵌入向量之间的距离反馈物料相似度或者相关度的能力，我们可以使用Top-K准确率（$Recall@K$），Top-K准确率表示在与物料$i$的向量距离最小的$K$个物料中，有多少比例的物料也在与物料$i$用户重合度最高的$K$个物料列表中。Top-K准确率越高，意味着嵌入向量推荐相似或者相关物料的能力越强。

实验使用的数据集为[MovieLens 1M](https://grouplens.org/datasets/movielens/1m/)数据集，包含100万条用户对电影的评分数据。我们将每个电影的简介作为文本内容，使用文本嵌入模型将其转换为向量。然后计算每个电影的向量与其他电影的向量之间的距离，并根据距离进行排序，取Top-K电影。最后计算这些Top-K电影与原始电影在用户重叠度上的Top-K准确率。

## 文本嵌入模型

开源模型我们选择了Ollama下载量前三的模型，它们分别是：

- [nomic-embed-text](https://ollama.com/library/nomic-embed-text)
- [mxbai-embed-large](https://ollama.com/library/mxbai-embed-large)
- [bge-m3](https://ollama.com/library/bge-m3)

商业模型我们选择了阿里云和OpneAI各自的最强文本嵌入模型：

- [text-embedding-v4](https://bailian.console.aliyun.com/?spm=5176.29597918.J_SEsSjsNv72yRuRFS2VknO.2.52007ca0kyUn9Q&tab=api#/api/?type=model&url=https%3A%2F%2Fhelp.aliyun.com%2Fdocument_detail%2F2712515.html)（阿里云）支持8种向量维度，支持100+主流语种及多种编程语言
- [text-embedding-3-large](https://openai.com/index/new-embedding-models-and-api-updates/)（OpenAI）同样支持多种向量维度和多种语言

::: note

测试商业模型他需要花费一定的费用，为了控制成本，我们没有测试来自更多服务商的模型。我们开源了[测试脚本](https://github.com/gorse-cloud/embedding4rec)，欢迎大家在自己的环境中运行测试脚本来获取更多模型的性能数据。

:::

## 实验结果


::: echarts BF16向量加法性能对比

```json
{
  "legend": {
    "data": ["text-embedding-v4", "text-embedding-3-large", "nomic-embed-text", "mxbai-embed-large", "bge-m3"]
  },
  "xAxis": {
    "name": "向量长度",
    "data": [64, 128, 256, 512, 768, 1024, 2048, 3072]
  },
  "yAxis": {
    "name": "准确率@100",
    "type": "value",
    "min": 0.1
  },
  "tooltip": {
    "trigger": "item",
    "formatter": "{c}"
  },
  "series": [
    {
      "name": "text-embedding-v4",
      "data": [0.11969, 0.13873, 0.15280, 0.1627, 0.16674, 0.16946, 0.17262],
      "type": "line",
      "smooth": true
    },
    {
      "name": "text-embedding-3-large",
      "data": [0.11272, 0.13769, 0.15086, 0.16362, 0.16610, 0.17026, 0.17241, 0.17395],
      "type": "line",
      "smooth": true
    },
    {
      "name": "nomic-embed-text",
      "data": [null, null, null, null, 0.15161],
      "type": "line"
    },
    {
      "name": "mxbai-embed-large",
      "data": [null, null, null, null, null, 0.16595],
      "type": "line"
    },
    {
      "name": "bge-m3",
      "data": [null, null, null, null, null, 0.11492],
      "type": "line"
    }
  ]
}
```

:::

- 《后窗》（1954年）由阿尔弗雷德·希区柯克执导，是一部紧张悬疑的惊悚片，讲述了由詹姆斯·斯图尔特饰演的轮椅摄影师L.B.杰弗里斯逐渐确信邻居犯下谋杀案的故事。因腿伤困于公寓的杰弗里斯终日透过后窗窥探邻居生活，对其隐私产生危险的执念。在女友丽莎（格蕾丝·凯利饰）协助下搜集证据时，剧情张力渐增，最终走向探讨偷窥欲、道德与隐私界限的高潮。希区柯克以精妙的镜头语言和叙事手法构建悬疑，使《后窗》成为惊悚片经典。
- 《爱德华大夫》（1945年）是希区柯克执导的心理惊悚片，探索人类心智的复杂性与梦境本质。英格丽·褒曼饰演的精神科医生康斯坦斯被自称新院长的失忆男子约翰（格利高里·派克饰）吸引。当她深入约翰潜意识破解其身份之谜与原院长谋杀案时，也直面了自己的情感与心理障碍。达利设计的超现实梦境场景，结合爱情、执念与心灵迷宫的主题，使影片以悬疑与心理深度俘获观众。
- 1960年希区柯克执导的《惊魂记》是开创性心理惊悚片，讲述挪用公款逃亡的玛丽莲·克兰误入偏僻的贝茨汽车旅馆。旅馆主人诺曼·贝茨表面温顺，实则深受"母亲"操控。影片以悬疑叙事、标志性"浴室"镜头及对身份认同、孤独与人性的探讨闻名。其大师级导演手法与经典配乐，使其成为重塑电影叙事界限的恐怖片里程碑。
- 1959年悬疑惊悚片《西北偏北》由希区柯克执导，加里·格兰特饰演广告商罗杰，因被误认为间谍而遭追杀。从纽约到拉什莫尔山的跨国逃亡中，他深陷身份错位与阴谋。影片融合喜剧与悬疑，通过犀利对白和经典场景展现希区柯克对"无辜者受困"主题的拿捏。
- 1950年英国悬疑片《欲海惊魂》以伦敦戏剧界为背景。简·怀曼饰演的演员凯蒂卷入前情人谋杀案调查，在追查真相时陷入情感纠葛。希区柯克标志性的心理张力与反转叙事，让悬念持续至终场。
- 1954年《电话谋杀案》中，托尼精心策划杀妻谋财，计划失败后引发连环反转。格蕾丝·凯利饰演的玛戈成为亮点，影片在密闭空间中展现背叛、欺骗与人际关系的复杂，彰显希区柯克叙事功力。
- 1946年心理惊悚片《螺旋楼梯》由罗伯特·西奥德马克执导，讲述哑女海伦在新英格兰豪宅侍奉时成为连环杀手目标。阴影构图与阴森氛围使其成为黑色电影典范。
- 1953年黑色电影《搭车人》是艾达·卢皮诺执导的首部女性导演同类作品，描述两名钓友被精神病逃犯劫持的猫鼠游戏，荒凉景观中探讨人性恐惧与求生欲。
- 1943年《辣手摧花》中，少女查理发现魅力四射的叔叔可能是连环杀手。希区柯克以田园小镇与暗黑角色的反差营造张力，质疑道德与信任的边界。
- 1988年阿莫多瓦执导的《精神濒临崩溃的女人》以艳丽的马德里为背景，女演员佩帕在追索负心汉时邂逅一系列怪诞角色。影片用荒诞幽默与社会讽刺勾勒女性脆弱与坚韧，奠定导演风格。


- 《π》（1998）是达伦·阿罗诺夫斯基执导的心理惊悚片，讲述天才数学家马克斯·科恩痴迷于寻找宇宙规律的故事。当他发现一组神秘的216位数字后，偏执地认为这是破解现实混沌本质的密钥。在华尔街公司和犹太教派的双重压力下，马克斯逐渐陷入精神崩溃的深渊。影片通过高对比度黑白摄影与梦魇般的配乐，深刻探讨了执念、疯狂与启蒙的悖论。
- 《无声的坠落》（1994）围绕退休儿童心理医生杰克·雷纳（理查德·德莱弗斯饰）展开，他被卷入一起双尸命案调查。唯一目击者自闭症男孩蒂姆（本·福克纳饰）的沟通障碍使案情扑朔迷离。当杰克试图唤醒男孩记忆时，却陷入由蒂姆姐姐西尔维（丽芙·泰勒饰）编织的秘密网络。影片以创伤心理为切口，揭示了人类心智的脆弱边界。
- 《崩溃边缘的女人》（1988）是佩德罗·阿莫多瓦执导的黑色喜剧。女演员佩帕（卡门·毛拉饰）在情人伊万不告而别后，阴差阳错卷入恐怖分子、情敌等荒诞人物构成的关系网中。影片以马德里为舞台，用超现实手法融合社会批判，展现了女性在情感危机中既坚韧又脆妙的生存状态，奠定了阿莫多瓦标志性的视觉风格。
- 《欲望号快车》（1996）是大卫·柯南伯格执导的先锋电影，聚焦詹姆斯与凯瑟琳这对夫妇逐渐沉迷车祸性癖的亚文化圈。影片以冷峻镜头语言探讨科技时代下疼痛与快感的暧昧共生，其挑战伦理的叙事引发关于人际关系本质的深层思考。
- 《大开眼戒》（1999）是库布里克遗作，讲述比尔医生（汤姆·克鲁斯饰）在妻子（妮可·基德曼饰）坦承性幻想后，夜探神秘性爱仪式的心理惊魂。通过面具狂欢与贵族密室的隐喻，影片剖开了中产阶级婚姻表象下的欲望暗流。
- 《惊魂记》（1960）希区柯克经典之作，秘书玛丽莲携款潜逃至贝茨汽车旅馆，与受母亲控制的诺曼展开致命邂逅。浴室谋杀戏成为影史标杆，其精神分析叙事重新定义了恐怖片类型。
- 《窥视窗》（1980）赫伯·弗里德执导的心理惊悚片，描绘摄影师丽莎被街对面神秘男子监视后逐渐崩溃的过程。影片通过80年代特有的技术焦虑，探讨了观看与被看的权力关系。
- 《翌晨》（1986）简·方达饰演的过气歌手宿醉后发现床具男尸，在警探（杰夫·布里吉斯饰）协助下追溯真相。这部悬疑片巧妙融合了自我救赎与黑色电影元素。
- 《西北偏北》（1959）希区柯克悬念杰作，广告商罗杰（加里·格兰特饰）被误认为间谍后展开横跨美国的逃亡。影片以玉米地飞机追杀和总统山对决等名场面，完美平衡了幽默与惊险。
- 《偷窥狂》（1960）迈克尔·鲍威尔争议之作，记录连环杀手马克用摄影机捕捉受害者恐惧的变态过程。这部超前时代的元电影，尖锐批判了观众对暴力的窥淫癖好。
